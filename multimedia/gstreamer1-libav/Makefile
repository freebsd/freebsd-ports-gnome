# Created by: Koop Mast <kwm@rainbow-runner.nl>
# $FreeBSD$

PORTNAME=	gstreamer1-libav
PORTVERSION=	1.12.3
PORTREVISION=	2
CATEGORIES=	multimedia
MASTER_SITES=	http://gstreamer.freedesktop.org/src/gst-libav/
DISTNAME=	gst-libav-${PORTVERSION}

MAINTAINER=	multimedia@FreeBSD.org
COMMENT=	GStreamer plug-in with many audio/video decoders/encoders

LICENSE=	GPLv2
LICENSE_FILE=	${WRKSRC}/COPYING

BUILD_DEPENDS=	orc>=0.4.16:devel/orc
LIB_DEPENDS=	liborc-0.4.so:devel/orc

PORTSCOUT=	limitw:1,even

USES=		compiler:features gettext-runtime gmake libtool localbase \
		pkgconfig python:build tar:xz
USE_LDCONFIG=	yes
USE_GSTREAMER1=	yes
USE_GNOME=	glib20
GNU_CONFIGURE=	yes
INSTALL_TARGET=	install-strip
CFLAGS_powerpc64=	-mminimal-toc

OPTIONS_DEFINE=	FFMPEG

FFMPEG_DESC?=	Use system ffmpeg instead of internal libav
FFMPEG_BROKEN=	fails to build with ffmpeg 4.0, see bug 227748
FFMPEG_LIB_DEPENDS=	libavcodec.so:multimedia/ffmpeg
FFMPEG_CONFIGURE_WITH=	system-libav
FFMPEG_BUILD_DEPENDS_OFF=as:devel/binutils nasm:devel/nasm
FFMPEG_CONFIGURE_ENV_OFF=${MACHINE:Marm*:C/.+/ASFLAGS=-no-integrated-as/}
FFMPEG_MAKE_ENV_OFF=	V=1
FFMPEG_VARS_OFF+=	NOPRECIOUSMAKEVARS=yes # ARCH
FFMPEG_VARS_OFF+=	LLD_UNSAFE=yes # aarch64

post-patch:
	@${REINPLACE_CMD} -e 's|-Werror||g' \
		${WRKSRC}/configure

.include <bsd.port.mk>
