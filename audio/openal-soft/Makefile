# $FreeBSD$

PORTNAME=	openal-soft
PORTVERSION=	1.18.2
PORTREVISION=	2
CATEGORIES=	audio
MASTER_SITES=	http://kcat.strangesoft.net/openal-releases/

MAINTAINER=	tobik@FreeBSD.org
COMMENT=	Software implementation of the OpenAL specification

LICENSE=	LGPL20+
LICENSE_FILE=	${WRKSRC}/COPYING

CONFLICTS=	openal-200[0-9]*

USES=		cmake:outsource compiler:c11 tar:bzip2
USE_LDCONFIG=	yes
LLD_UNSAFE=	yes
CMAKE_ARGS=	-DCMAKE_INSTALL_DATADIR:STRING="${PREFIX}/etc"
CMAKE_OFF=	ALSOFT_BACKEND_ALSA \
		ALSOFT_DLOPEN \
		ALSOFT_EXAMPLES \
		ALSOFT_REQUIRE_SOLARIS \
		ALSOFT_REQUIRE_QSA
CMAKE_ON=	ALSOFT_BACKEND_WAVE \
		ALSOFT_UTILS
LDFLAGS+=	-Wl,--as-needed # do not link with librt and libdl

OPTIONS_DEFINE=		EXAMPLES CONFIG JACK OSS PORTAUDIO PULSEAUDIO SNDIO
OPTIONS_DEFAULT=	OSS
OPTIONS_SUB=		yes

CONFIG_DESC=		Install configuration utility (needs Qt 4.x)

CONFIG_CMAKE_BOOL_OFF=	ALSOFT_NO_CONFIG_UTIL
CONFIG_CMAKE_ON=	-DALSOFT_NO_QT5:BOOL=ON
CONFIG_USE=		QT4=corelib,gui,qmake_build,moc_build,rcc_build,uic_build

JACK_CMAKE_BOOL=	ALSOFT_REQUIRE_JACK ALSOFT_BACKEND_JACK
JACK_LIB_DEPENDS=	libjack.so:audio/jack

OSS_CMAKE_BOOL=		ALSOFT_REQUIRE_OSS ALSOFT_BACKEND_OSS

PORTAUDIO_CMAKE_BOOL=	ALSOFT_REQUIRE_PORTAUDIO ALSOFT_BACKEND_PORTAUDIO
PORTAUDIO_LIB_DEPENDS=	libportaudio.so:audio/portaudio

PULSEAUDIO_CMAKE_BOOL=	ALSOFT_REQUIRE_PULSEAUDIO ALSOFT_BACKEND_PULSEAUDIO
PULSEAUDIO_LIB_DEPENDS=	libpulse.so:audio/pulseaudio

SNDIO_CMAKE_BOOL=	ALSOFT_REQUIRE_SNDIO ALSOFT_BACKEND_SNDIO
SNDIO_IMPLIES=		OSS # provide fallback for missing sndio capture support
SNDIO_LIB_DEPENDS=	libsndio.so:audio/sndio

post-patch:
	@${REINPLACE_CMD} 's|/etc/openal|${ETCDIR}|' \
		${WRKSRC}/Alc/alcConfig.c

post-install-EXAMPLES-on:
	(cd ${WRKSRC}/examples && ${COPYTREE_SHARE} . \
		${STAGEDIR}${EXAMPLESDIR})

.include <bsd.port.mk>
